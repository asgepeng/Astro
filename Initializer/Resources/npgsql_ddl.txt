-- countries
CREATE TABLE countries (
    countryid           SMALLINT        PRIMARY KEY,
    name                VARCHAR(100)    NOT NULL DEFAULT '',
    a2code              CHAR(2)         NOT NULL DEFAULT '',
    a3code              CHAR(3)         NOT NULL DEFAULT '',
    phonecode           INTEGER         NOT NULL DEFAULT 0
);

-- provinces
CREATE TABLE states (
    stateid             SMALLINT        PRIMARY KEY,
    name                VARCHAR(100)    NOT NULL DEFAULT '',
    countryid           SMALLINT        NOT NULL DEFAULT 0
);

-- cities
CREATE TABLE cities (
    cityid              INTEGER         PRIMARY KEY,
    name                VARCHAR(200)    NOT NULL DEFAULT '',
    stateid             SMALLINT         NOT NULL DEFAULT 0
);
--districts
CREATE TABLE districts (
	districtid          INTEGER         PRIMARY KEY,
	name                VARCHAR(100)    NOT NULL DEFAULT '',
	cityid              INTEGER         NOT NULL DEFAULT 0
);

-- villages
CREATE TABLE villages (
	villageid           BIGINT          PRIMARY KEY,
	name                VARCHAR(100)    NOT NULL DEFAULT '',
	districtid          INTEGER        NOT NULL DEFAULT 0,
    zipcode             INT     NOT NULL DEFAULT 0
);

-- stores
CREATE TABLE locations (
    locationid         SMALLSERIAL       PRIMARY KEY,
	name               VARCHAR(100)    NOT NULL DEFAULT '',
	streetaddress      VARCHAR(250)    NOT NULL DEFAULT '',
	villageid          BIGINT          NOT NULL DEFAULT 0,
	zipcode            VARCHAR(15)     NOT NULL DEFAULT '',
	phone              VARCHAR(30)     NOT NULL DEFAULT '',
	fax                VARCHAR(30)     NOT NULL DEFAULT '',
	email              VARCHAR(80)     NOT NULL DEFAULT '',
	creatorid         SMALLINT        NOT NULL DEFAULT 0,
	createddate       TIMESTAMP       NOT NULL DEFAULT CURRENT_TIMESTAMP,
	editorid          SMALLINT,
	editeddate        TIMESTAMP
);

-- employees
CREATE TABLE employees (
    employeeid          SMALLSERIAL NOT NULL PRIMARY KEY,
    fullname            VARCHAR(200) NOT NULL DEFAULT '',
    placeofbirth        VARCHAR(50) NOT NULL DEFAULT '',
    dateofbirth         DATE NOT NULL DEFAULT '1900-01-01',
    sex                 SMALLINT NOT NULL DEFAULT 0,
    maritalstatus       SMALLINT NOT NULL DEFAULT 0,
    streetaddress       VARCHAR(250) NOT NULL DEFAULT '',
    villageid           BIGINT NOT NULL DEFAULT 0,
    zipcode             VARCHAR(15) NOT NULL DEFAULT '',
    phone               VARCHAR(30) NOT NULL DEFAULT '',
    email               VARCHAR(80) NOT NULL DEFAULT '',
    hireddate           DATE NOT NULL DEFAULT '1900-01-01',
    roleid              SMALLINT NOT NULL DEFAULT 0,
    isactive            BOOLEAN NOT NULL DEFAULT true,
    terminationdate     DATE NULL,
    payrolldate         SMALLINT NOT NULL DEFAULT 0,
    payrollmethod       SMALLINT NOT NULL DEFAULT 0,
    notes               VARCHAR(250) NOT NULL DEFAULT '',
    creatorid             SMALLINT NOT NULL DEFAULT 0,
    createddate         TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    editorid              SMALLINT,
    editeddate          TIMESTAMP,
    isdeleted           BOOLEAN NOT NULL DEFAULT false
);
-- payrolls
CREATE TABLE payrolls (
    payrollid           BIGSERIAL       PRIMARY KEY,
	employeeid          SMALLINT        NOT NULL DEFAULT 0,
	period              VARCHAR(20)     NOT NULL DEFAULT '',
	salary              BIGINT          NOT NULL DEFAULT 0,
	bonus               BIGINT          NOT NULL DEFAULT 0,
	deductions          BIGINT          NOT NULL DEFAULT 0,
	netpay              BIGINT          NOT NULL DEFAULT 0,
	creatorid           SMALLINT        NOT NULL DEFAULT 0,
	createddate         TIMESTAMP       NOT NULL DEFAULT CURRENT_TIMESTAMP,
	editorid            SMALLINT,
	editeddate          TIMESTAMP
);
-- logins
CREATE TABLE logins (
    employeeid          SMALLINT        NOT NULL DEFAULT 0,
    passwordhash        VARCHAR(255)    NOT NULL DEFAULT '',
    accessfailedcount   SMALLINT        NOT NULL DEFAULT 0,
    lockoutenabled      BOOLEAN NOT NULL DEFAULT false,
    lockoutend          TIMESTAMP NULL,
    usepasswordexpiration BOOLEAN NOT NULL DEFAULT false,
    passwordexpirationdate   DATE NULL,
    creatorid           SMALLINT        NOT NULL DEFAULT 0,
    createddate         TIMESTAMP       NOT NULL DEFAULT CURRENT_TIMESTAMP,
    editorid            SMALLINT,
    editeddate          TIMESTAMP
);
-- employeelocations
CREATE TABLE employeelocations (
    employeeid          SMALLINT        NOT NULL DEFAULT 0,
	locationid          SMALLINT        NOT NULL DEFAULT 0,
	isprimary           BOOLEAN         NOT NULL DEFAULT false,
	creatorid          SMALLINT        NOT NULL DEFAULT 0,
	editorid           SMALLINT,
	createddate        TIMESTAMP       NOT NULL DEFAULT CURRENT_TIMESTAMP,
	editeddate         TIMESTAMP,
	CONSTRAINT pk_employeelocations PRIMARY KEY (employeeid, locationid)
);
-- roles
CREATE TABLE roles (
    roleid             SMALLSERIAL     PRIMARY KEY,
    name           VARCHAR(150)    NOT NULL DEFAULT '',
    creatorid          SMALLINT        NOT NULL DEFAULT 0,
    createddate        TIMESTAMP       NOT NULL DEFAULT CURRENT_TIMESTAMP,
    editorid           SMALLINT,
    editeddate         TIMESTAMP
);

-- sections
CREATE TABLE sections (
    sectionid           SMALLSERIAL     PRIMARY KEY,
    title               VARCHAR(100)    NOT NULL DEFAULT '',
    disabled            BOOLEAN         NOT NULL DEFAULT false
);

-- menus
CREATE TABLE menus (
    menuid              SMALLSERIAL     PRIMARY KEY,
    sectionid           SMALLINT        NOT NULL DEFAULT 0,
    title               VARCHAR(100)    NOT NULL DEFAULT '',
    tooltiptext         VARCHAR(250)    NOT NULL DEFAULT '',
    disabled            BOOLEAN         NOT NULL DEFAULT false
);

-- roletomenus
CREATE TABLE rolemenus (
    roleid             SMALLINT        NOT NULL,
    menuid             SMALLINT        NOT NULL,
    allowcreate        BOOLEAN         NOT NULL DEFAULT false,
    allowread          BOOLEAN         NOT NULL DEFAULT false,
    allowupdate        BOOLEAN         NOT NULL DEFAULT false,
    allowdelete        BOOLEAN         NOT NULL DEFAULT false,
    PRIMARY KEY (roleid, menuid)
);

-- login attempt
CREATE TABLE loginattempts
(
    attemptid               SERIAL          PRIMARY KEY,
    attempttime             TIMESTAMP       NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    employeeid              SMALLINT        NOT NULL DEFAULT 0,
    ipv4                    BYTEA,
    ipv6                    BYTEA,
    useragent               VARCHAR(255)    NOT NULL DEFAULT '',
    success                 BOOLEAN         NOT NULL DEFAULT false,
    notes                   VARCHAR(255)    NOT NULL DEFAULT ''
);

-- addresses
CREATE TABLE addresses (
    addressid           SERIAL          PRIMARY KEY,
    contactid           BIGINT          NOT NULL DEFAULT 0,
    addresstype                SMALLINT        NOT NULL DEFAULT 0,
    streetaddress      VARCHAR(250)    NOT NULL DEFAULT '',
    villageid          BIGINT            NOT NULL DEFAULT 0,
    zipcode            VARCHAR(15)     NOT NULL DEFAULT '',
    isprimary          BOOLEAN         NOT NULL DEFAULT false
);

-- emails
CREATE TABLE emails (
    emailid            SERIAL          PRIMARY KEY,
    contactid            SMALLINT        NOT NULL DEFAULT 0,
    emailaddress       VARCHAR(60)     NOT NULL DEFAULT '',
    emailtype          SMALLINT        NOT NULL DEFAULT 0,
    isprimary          BOOLEAN         NOT NULL DEFAULT false,
    creatorid          SMALLINT        NOT NULL DEFAULT 0,
    createddate        TIMESTAMP       NOT NULL DEFAULT CURRENT_TIMESTAMP,
    editorid           SMALLINT,
    editeddate         TIMESTAMP
);

-- phones
CREATE TABLE phones (
    phoneid            SERIAL      PRIMARY KEY,
    contactid          SMALLINT    NOT NULL    DEFAULT 0,
    phonetype          SMALLINT    NOT NULL    DEFAULT 0,
    phonenumber        VARCHAR(50) NOT NULL    DEFAULT '',
    phoneext           SMALLINT    NOT NULL    DEFAULT 0,
    isprimary          BOOLEAN     NOT NULL    DEFAULT false,
    creatorid          SMALLINT    NOT NULL    DEFAULT 0,
    createddate        TIMESTAMP   NOT NULL    DEFAULT CURRENT_TIMESTAMP,
    editorid           SMALLINT,
    editeddate         TIMESTAMP
);

-- faxes
CREATE TABLE faxes (
    faxid              SERIAL      PRIMARY KEY,
    ownerid            SMALLINT    NOT NULL DEFAULT 0,
    faxtype            SMALLINT    NOT NULL DEFAULT 0,
    faxnumber          VARCHAR(60) NOT NULL DEFAULT '',
    creatorid          SMALLINT    NOT NULL DEFAULT 0,
    createddate        TIMESTAMP   NOT NULL DEFAULT CURRENT_TIMESTAMP,
    editorid           SMALLINT,
    editeddate         TIMESTAMP
);

-- auths
CREATE TABLE auths (
    token               UUID            PRIMARY KEY,
    employeeid          SMALLINT        NOT NULL DEFAULT 0,
    tokenexpired        TIMESTAMP       NOT NULL,
    ipv4                INT             NOT NULL,
    ipv6                INET,
    useragent          VARCHAR(250)    NOT NULL DEFAULT ''
);

-- units
CREATE TABLE units (
    unitid             SMALLSERIAL     PRIMARY KEY,
    name                VARCHAR(50)     NOT NULL    DEFAULT '',
    creatorid          SMALLINT        NOT NULL    DEFAULT 0,
    createddate        TIMESTAMP       NOT NULL    DEFAULT CURRENT_TIMESTAMP,
    editorid           SMALLINT,
    editeddate         TIMESTAMP
);

-- categories
CREATE TABLE categories (
    categoryid         SMALLSERIAL     PRIMARY KEY,
    name                VARCHAR(100)    NOT NULL DEFAULT '',
    creatorid          SMALLINT        NOT NULL DEFAULT 0,
    createddate        TIMESTAMP       NOT NULL DEFAULT CURRENT_TIMESTAMP,
    editorid           SMALLINT,
    editeddate         TIMESTAMP,
    isdeleted          BOOLEAN         NOT NULL DEFAULT false
);
-- products
CREATE TABLE products (
    productid          SMALLSERIAL     PRIMARY KEY,
    name        VARCHAR(100)    NOT NULL    DEFAULT '',
    description VARCHAR(8000)   NOT NULL    DEFAULT '',
    sku         VARCHAR(40)     NOT NULL    DEFAULT '',
    parentid           SMALLINT        NOT NULL    DEFAULT 0,
    categoryid         SMALLINT        NOT NULL    DEFAULT 0,
    unitid             SMALLINT        NOT NULL    DEFAULT 0,
    manufactureid      SMALLINT        NOT NULL    DEFAULT 0,
    producttype        INTEGER         NOT NULL    DEFAULT 0,
    taxable            BOOLEAN         NOT NULL    DEFAULT false,
    taxfactor           DECIMAL(5,2) NOT NULL DEFAULT 0.00,
    percenttax          DECIMAL(5,2)    NOT NULL    DEFAULT 0.00,
    images              VARCHAR(250)    NOT NULL    DEFAULT '',
    creatorid          SMALLINT        NOT NULL    DEFAULT 0,
    createddate        TIMESTAMP       NOT NULL    DEFAULT CURRENT_TIMESTAMP,
    editorid           SMALLINT,
    editeddate         TIMESTAMP,
    isdeleted          BOOLEAN         NOT NULL    DEFAULT false
);

-- inventories
CREATE TABLE inventories (
	locationid         SMALLINT        NOT NULL,
	productid          SMALLINT        NOT NULL,
    isactive           BOOLEAN         NOT NULL    DEFAULT false,
    buyprice            BIGINT          NOT NULL    DEFAULT 0,
    cogs                BIGINT          NOT NULL    DEFAULT 0,
    price               BIGINT          NOT NULL    DEFAULT 0,
    stock               INT             NOT NULL    DEFAULT 0,
	minstock           SMALLINT        NOT NULL    DEFAULT 0,
	maxstock           SMALLINT        NOT NULL    DEFAULT 0,
	creatorid          SMALLINT        NOT NULL    DEFAULT 0,
	createddate        TIMESTAMP       NOT NULL    DEFAULT CURRENT_TIMESTAMP,
	editorid           SMALLINT,
	editeddate         TIMESTAMP,
    CONSTRAINT pk_inventories PRIMARY KEY (locationid, productid)
);

-- contacts
CREATE TABLE contacts (
    contactid          SERIAL          PRIMARY KEY,
    name                VARCHAR(250)    NOT NULL DEFAULT '',
    title               VARCHAR(100)    NOT NULL DEFAULT '',
    organizationid      SMALLINT        NOT NULL DEFAULT 0,
    contacttype        SMALLINT        NOT NULL DEFAULT 0,
    groupid            SMALLINT        NOT NULL DEFAULT 0,
    accountlimit       INTEGER         NOT NULL DEFAULT 0,
    accountdue         SMALLINT        NOT NULL DEFAULT 0,
    creatorid          SMALLINT        NOT NULL DEFAULT 0,
    createddate        TIMESTAMP       NOT NULL DEFAULT CURRENT_TIMESTAMP,
    editorid           SMALLINT,
    editeddate         TIMESTAMP,
    isdeleted          BOOLEAN         NOT NULL DEFAULT false
);

-- wsprices
CREATE TABLE wsprices (
    productid BIGINT NOT NULL,
    minqty SMALLINT NOT NULL,
    price BIGINT NOT NULL DEFAULT 0,
    PRIMARY KEY (productid, minqty)
);

-- promotions
CREATE TABLE promotions (
    promoid BIGSERIAL PRIMARY KEY,
    title VARCHAR(250) NOT NULL DEFAULT '',
    startdate TIMESTAMP NOT NULL,
    enddate TIMESTAMP NOT NULL,
    isactive BOOLEAN NOT NULL DEFAULT false,
    creatorid SMALLINT NOT NULL DEFAULT 0,
    createddate TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    editorid SMALLINT,
    editeddate TIMESTAMP,
    isdeleted BOOLEAN NOT NULL DEFAULT false
);

-- promoproducts
CREATE TABLE promoproducts (
    promoid BIGINT NOT NULL,
    productid SMALLINT NOT NULL,
    promotype SMALLINT NOT NULL DEFAULT 0,
    promovalue BIGINT NOT NULL DEFAULT 0,
    PRIMARY KEY (promoid, productid)
);

-- groupprices
CREATE TABLE groupprices (
    groupid SMALLINT NOT NULL,
    productid SMALLINT NOT NULL,
    min_qty BIGINT NOT NULL DEFAULT 0,
    discounttype SMALLINT NOT NULL DEFAULT 0,
    discountamount BIGINT NOT NULL DEFAULT 0,
    PRIMARY KEY (groupid, productid)
);

-- vouchers
CREATE TABLE vouchers (
    voucherid BIGINT PRIMARY KEY,
    voucherexpired_date TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    voucheramount BIGINT NOT NULL DEFAULT 0,
    creatorid BIGINT NOT NULL DEFAULT 0,
    createddate TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- accproviders
CREATE TABLE accountproviders (
    providerid SMALLINT PRIMARY KEY,
    name VARCHAR(100) NOT NULL DEFAULT '',
    providertype SMALLINT NOT NULL DEFAULT 0
);

-- accounts
CREATE TABLE accounts (
    accountid SERIAL PRIMARY KEY,
    accountname VARCHAR(250) NOT NULL DEFAULT '',
    accountnumber VARCHAR(50) NOT NULL DEFAULT '',
    providerid SMALLINT NOT NULL DEFAULT 0,
    creatorid SMALLINT NOT NULL DEFAULT 0,
    createddate TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    editorid SMALLINT,
    editeddate TIMESTAMP,
    isdeleted BOOLEAN NOT NULL DEFAULT false
);

-- cashflows
CREATE TABLE cashflows (
    cashflowid         UUID            PRIMARY KEY,
    cashflowdate       TIMESTAMP       NOT NULL DEFAULT CURRENT_TIMESTAMP,
    refid               UUID            NOT NULL,
    reftype            SMALLINT        NOT NULL,
    accountid          SMALLINT        NOT NULL,
    accounttype        SMALLINT        NOT NULL,
    amount  	        BIGINT          NOT NULL,
    notes              VARCHAR(250)    NOT NULL DEFAULT '',
    creatorid          SMALLINT        NOT NULL DEFAULT 0,
    createddate        TIMESTAMP       NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE receipts
(
    id                  BIGSERIAL       NOT NULL    PRIMARY KEY,
    saleid             UUID            NOT NULL,
    method      SMALLINT        NOT NULL    DEFAULT 0,
    cashflowid         UUID             NOT NULL
);

CREATE TABLE costs 
(
    id              BIGSERIAL           NOT NULL    PRIMARY KEY,
    refid           UUID                NOT NULL,
    amount          INT                 NOT NULL    DEFAULT 0,
    notes           VARCHAR(250)        NOT NULL    DEFAULT ''
);

-- stockflows
CREATE TABLE stockflows
(
    flowid          BIGSERIAL   PRIMARY KEY,
    flowdate       TIMESTAMP   NOT NULL    DEFAULT CURRENT_TIMESTAMP,
    locationid     SMALLINT    NOT NULL,
    refid           UUID        NOT NULL,
    reftype         SMALLINT    NOT NULL,
    productid      SMALLINT    NOT NULL,
    productname   VARCHAR(250) NOT NULL DEFAULT '',
    productsku      VARCHAR(40)  NOT NULL DEFAULT '',
    productunit     VARCHAR(25) NOT NULL,
    taxable		 BOOLEAN     NOT NULL    DEFAULT false,
    taxfactor   DECIMAL(5,2) NOT NULL DEFAULT 0.00,
    taxpercent  DECIMAL(5,2) NOT NULL DEFAULT 0.00,
    cogs            BIGINT      NOT NULL    DEFAULT 0,
    stock           INT         NOT NULL    DEFAULT 0,
    quantity        INT         NOT NULL,
    price           BIGINT      NOT NULL    DEFAULT 0,
    discount        INT         NOT NULL    DEFAULT 0,
    taxamount       INT         NOT NULL    DEFAULT 0,
    notes           VARCHAR(250) NOT NULL   DEFAULT '',
    creatorid      SMALLINT    NOT NULL    DEFAULT 0,
    createddate    TIMESTAMP   NOT NULL    DEFAULT CURRENT_TIMESTAMP
);

-- sales
CREATE TABLE sales (
    saleid         UUID PRIMARY KEY,
    locationid     SMALLINT,  -- FK ke locations
    invoicenumber  VARCHAR(50) NOT NULL,
    saledate       TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    customerid     SMALLINT,  -- FK ke customers
    subtotal       BIGINT NOT NULL DEFAULT 0,
    discount       BIGINT NOT NULL DEFAULT 0,
    cost           BIGINT NOT NULL DEFAULT 0,
    grandtotal     BIGINT NOT NULL DEFAULT 0,
    tax            INT NOT NULL DEFAULT 0,
    totalreceipt   BIGINT NOT NULL DEFAULT 0,
    status         SMALLINT NOT NULL DEFAULT 0,
    notes          TEXT DEFAULT '',
    creatorid      SMALLINT,  -- FK ke users/employees
    createddate    TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- purchases
CREATE TABLE purchases
(
    purchaseid         UUID            NOT NULL PRIMARY KEY,
    invoicenumber      VARCHAR(50)     NOT NULL DEFAULT '',
    locationid         SMALLINT        NOT NULL DEFAULT 0,
    purchasedate       TIMESTAMP       NOT NULL DEFAULT CURRENT_TIMESTAMP,
    supplierid         SMALLINT        NOT NULL DEFAULT 0,
    subtotal           BIGINT          NOT NULL DEFAULT 0,
    discount            INT             NOT NULL DEFAULT 0,
    cost                INT             NOT NULL DEFAULT 0,
    grandtotal         BIGINT          NOT NULL DEFAULT 0,
    tax                 INT             NOT NULL DEFAULT 0,
    totalpaid       BIGINT          NOT NULL DEFAULT 0,
    status              SMALLINT        NOT NULL DEFAULT 0,
    notes               VARCHAR(250)    NOT NULL DEFAULT '',
    creatorid          SMALLINT        NOT NULL DEFAULT 0,
    createddate        TIMESTAMP       NOT NULL DEFAULT CURRENT_TIMESTAMP
);
-- stockopnames
CREATE TABLE stockopnames (
    opnameid           UUID            PRIMARY KEY,
    locationid         SMALLINT        NOT NULL DEFAULT 0,
    opnamedate         TIMESTAMP       NOT NULL DEFAULT CURRENT_TIMESTAMP,
    productid          SMALLINT        NOT NULL DEFAULT 0,
    systemstcok        INT             NOT NULL DEFAULT 0,
    actualstock         INT             NOT NULL DEFAULT 0,
    difference          INT             NOT NULL DEFAULT 0,
    amount              BIGINT          NOT NULL DEFAULT 0,
    notes               VARCHAR(255)    NOT NULL DEFAULT '',
    creatorid          SMALLINT        NOT NULL DEFAULT 0,
    createddate        TIMESTAMP       NOT NULL DEFAULT CURRENT_TIMESTAMP
);

